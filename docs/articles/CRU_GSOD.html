<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get CRU Data for GSOD Station Locations • getCRUCLdata</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">getCRUCLdata</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/getCRUCLdata">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Get CRU Data for GSOD Station Locations</h1>
                        <h4 class="author">Adam H Sparks</h4>
            
            <h4 class="date">2017-06-10</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The GSOD or <a href="https://data.noaa.gov/dataset/global-surface-summary-of-the-day-gsod">Global Surface Summary of the Day (GSOD)</a> data provided by the US National Centers for Environmental Information (NCEI) provide global weather data.</p>
</div>
<div id="download-extract-and-merge-cru-data-with-provided-gsod-climate-data" class="section level1">
<h1 class="hasAnchor">
<a href="#download-extract-and-merge-cru-data-with-provided-gsod-climate-data" class="anchor"></a>Download, extract and merge CRU data with provided GSOD climate data</h1>
<div id="setup-the-r-session" class="section level2">
<h2 class="hasAnchor">
<a href="#setup-the-r-session" class="anchor"></a>Setup the R session</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(getCRUCLdata)
<span class="kw">library</span>(GSODR)

## Get CRU v. CL 2.0 data</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">CRU_stack &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_CRU_stack.html">get_CRU_stack</a></span>(<span class="dt">pre =</span> <span class="ot">TRUE</span>,
                           <span class="dt">rd0 =</span> <span class="ot">TRUE</span>,
                           <span class="dt">tmp =</span> <span class="ot">TRUE</span>,
                           <span class="dt">dtr =</span> <span class="ot">TRUE</span>,
                           <span class="dt">reh =</span> <span class="ot">TRUE</span>,
                           <span class="dt">sunp =</span> <span class="ot">TRUE</span>,
                           <span class="dt">frs =</span> <span class="ot">TRUE</span>,
                           <span class="dt">wnd =</span> <span class="ot">TRUE</span>,
                           <span class="dt">cache =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## 
## Creating raster stack now.</code></pre>
</div>
<div id="extract-data-for-station-locations" class="section level2">
<h2 class="hasAnchor">
<a href="#extract-data-for-station-locations" class="anchor"></a>Extract data for station locations</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stations &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv</span>(
  <span class="st">"ftp://ftp.ncdc.noaa.gov/pub/data/noaa/isd-history.csv"</span>,
  <span class="dt">col_types =</span> <span class="st">"ccccccddddd"</span>,
  <span class="dt">col_names =</span> <span class="kw">c</span>(<span class="st">"USAF"</span>, <span class="st">"WBAN"</span>, <span class="st">"STN_NAME"</span>, <span class="st">"CTRY"</span>, <span class="st">"STATE"</span>, <span class="st">"CALL"</span>,
                <span class="st">"LAT"</span>, <span class="st">"LON"</span>, <span class="st">"ELEV_M"</span>, <span class="st">"BEGIN"</span>, <span class="st">"END"</span>), <span class="dt">skip =</span> <span class="dv">1</span>)

stations[stations <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="fl">999.9</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>
stations[stations <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">999</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>
stations &lt;-<span class="st"> </span>stations[<span class="op">!</span><span class="kw">is.na</span>(stations<span class="op">$</span>LAT) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(stations<span class="op">$</span>LON), ]
stations &lt;-<span class="st"> </span>stations[stations<span class="op">$</span>LAT <span class="op">!=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>stations<span class="op">$</span>LON <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>, ]
stations &lt;-<span class="st"> </span>stations[stations<span class="op">$</span>LAT <span class="op">&gt;</span><span class="st"> </span><span class="op">-</span><span class="dv">90</span> <span class="op">&amp;</span><span class="st"> </span>stations<span class="op">$</span>LAT <span class="op">&lt;</span><span class="st"> </span><span class="dv">90</span>, ]
stations &lt;-<span class="st"> </span>stations[stations<span class="op">$</span>LON <span class="op">&gt;</span><span class="st"> </span><span class="op">-</span><span class="dv">180</span> <span class="op">&amp;</span><span class="st"> </span>stations<span class="op">$</span>LON <span class="op">&lt;</span><span class="st"> </span><span class="dv">180</span>, ]
stations &lt;-<span class="st"> </span>stations[<span class="op">!</span><span class="kw">is.na</span>(stations<span class="op">$</span>STN_NAME), ]
stations<span class="op">$</span>STNID &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">paste</span>(stations<span class="op">$</span>USAF, stations<span class="op">$</span>WBAN, <span class="dt">sep =</span> <span class="st">"-"</span>))

stations &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(stations)
sp<span class="op">::</span><span class="kw">coordinates</span>(stations) &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span>LON <span class="op">+</span><span class="st"> </span>LAT
crs &lt;-<span class="st"> "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"</span>
sp<span class="op">::</span><span class="kw">proj4string</span>(stations) &lt;-<span class="st"> </span>sp<span class="op">::</span><span class="kw">CRS</span>(crs)

<span class="co"># create a vector of names for the raster layers in new stack</span>
CRU_stack_names &lt;-<span class="st"> </span><span class="kw">c</span>(
  <span class="kw">paste0</span>(
    <span class="st">"CRU_CL_2_0_"</span>,
    <span class="kw">names</span>(CRU_stack[<span class="dv">1</span>]),
    <span class="st">"_"</span>,
    <span class="kw">c</span>(
      <span class="st">"01"</span>,
      <span class="st">"02"</span>,
      <span class="st">"03"</span>,
      <span class="st">"04"</span>,
      <span class="st">"05"</span>,
      <span class="st">"06"</span>,
      <span class="st">"07"</span>,
      <span class="st">"08"</span>,
      <span class="st">"09"</span>,
      <span class="st">"10"</span>,
      <span class="st">"11"</span>,
      <span class="st">"12"</span>
    )
  ),
  <span class="kw">paste0</span>(
    <span class="st">"CRU_CL_2_0_"</span>,
    <span class="kw">names</span>(CRU_stack[<span class="dv">2</span>]),
    <span class="st">"_"</span>,
    <span class="kw">c</span>(
      <span class="st">"01"</span>,
      <span class="st">"02"</span>,
      <span class="st">"03"</span>,
      <span class="st">"04"</span>,
      <span class="st">"05"</span>,
      <span class="st">"06"</span>,
      <span class="st">"07"</span>,
      <span class="st">"08"</span>,
      <span class="st">"09"</span>,
      <span class="st">"10"</span>,
      <span class="st">"11"</span>,
      <span class="st">"12"</span>
    )
  ),
  <span class="kw">paste0</span>(
    <span class="st">"CRU_CL_2_0_"</span>,
    <span class="kw">names</span>(CRU_stack[<span class="dv">3</span>]),
    <span class="st">"_"</span>,
    <span class="kw">c</span>(
      <span class="st">"01"</span>,
      <span class="st">"02"</span>,
      <span class="st">"03"</span>,
      <span class="st">"04"</span>,
      <span class="st">"05"</span>,
      <span class="st">"06"</span>,
      <span class="st">"07"</span>,
      <span class="st">"08"</span>,
      <span class="st">"09"</span>,
      <span class="st">"10"</span>,
      <span class="st">"11"</span>,
      <span class="st">"12"</span>
    )
  ),
  <span class="kw">paste0</span>(
    <span class="st">"CRU_CL_2_0_"</span>,
    <span class="kw">names</span>(CRU_stack[<span class="dv">4</span>]),
    <span class="st">"_"</span>,
    <span class="kw">c</span>(
      <span class="st">"01"</span>,
      <span class="st">"02"</span>,
      <span class="st">"03"</span>,
      <span class="st">"04"</span>,
      <span class="st">"05"</span>,
      <span class="st">"06"</span>,
      <span class="st">"07"</span>,
      <span class="st">"08"</span>,
      <span class="st">"09"</span>,
      <span class="st">"10"</span>,
      <span class="st">"11"</span>,
      <span class="st">"12"</span>
    )
  ),
  <span class="kw">paste0</span>(
    <span class="st">"CRU_CL_2_0_"</span>,
    <span class="kw">names</span>(CRU_stack[<span class="dv">5</span>]),
    <span class="st">"_"</span>,
    <span class="kw">c</span>(
      <span class="st">"01"</span>,
      <span class="st">"02"</span>,
      <span class="st">"03"</span>,
      <span class="st">"04"</span>,
      <span class="st">"05"</span>,
      <span class="st">"06"</span>,
      <span class="st">"07"</span>,
      <span class="st">"08"</span>,
      <span class="st">"09"</span>,
      <span class="st">"10"</span>,
      <span class="st">"11"</span>,
      <span class="st">"12"</span>
    )
  ),
  <span class="kw">paste0</span>(
    <span class="st">"CRU_CL_2_0_"</span>,
    <span class="kw">names</span>(CRU_stack[<span class="dv">6</span>]),
    <span class="st">"_"</span>,
    <span class="kw">c</span>(
      <span class="st">"01"</span>,
      <span class="st">"02"</span>,
      <span class="st">"03"</span>,
      <span class="st">"04"</span>,
      <span class="st">"05"</span>,
      <span class="st">"06"</span>,
      <span class="st">"07"</span>,
      <span class="st">"08"</span>,
      <span class="st">"09"</span>,
      <span class="st">"10"</span>,
      <span class="st">"11"</span>,
      <span class="st">"12"</span>
    )
  ),
  <span class="kw">paste0</span>(
    <span class="st">"CRU_CL_2_0_"</span>,
    <span class="kw">names</span>(CRU_stack[<span class="dv">7</span>]),
    <span class="st">"_"</span>,
    <span class="kw">c</span>(
      <span class="st">"01"</span>,
      <span class="st">"02"</span>,
      <span class="st">"03"</span>,
      <span class="st">"04"</span>,
      <span class="st">"05"</span>,
      <span class="st">"06"</span>,
      <span class="st">"07"</span>,
      <span class="st">"08"</span>,
      <span class="st">"09"</span>,
      <span class="st">"10"</span>,
      <span class="st">"11"</span>,
      <span class="st">"12"</span>
    )
  ),
  <span class="kw">paste0</span>(
    <span class="st">"CRU_CL_2_0_"</span>,
    <span class="kw">names</span>(CRU_stack[<span class="dv">8</span>]),
    <span class="st">"_"</span>,
    <span class="kw">c</span>(
      <span class="st">"01"</span>,
      <span class="st">"02"</span>,
      <span class="st">"03"</span>,
      <span class="st">"04"</span>,
      <span class="st">"05"</span>,
      <span class="st">"06"</span>,
      <span class="st">"07"</span>,
      <span class="st">"08"</span>,
      <span class="st">"09"</span>,
      <span class="st">"10"</span>,
      <span class="st">"11"</span>,
      <span class="st">"12"</span>
    )
  )
)

<span class="co"># Create one stack object from list of stacks</span>
CRU_stack &lt;-<span class="st">  </span>raster<span class="op">::</span><span class="kw">stack</span>(<span class="kw">unlist</span>(CRU_stack))

<span class="co"># Extract CRU data at GSOD station locations</span>
CRU_GSOD &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">extract</span>(CRU_stack, stations)

<span class="co"># Merge station ID and location with CRU data using na.omit to save space</span>
CRU_GSOD &lt;-<span class="st"> </span><span class="kw">data.frame</span>(stations<span class="op">$</span>STNID, CRU_GSOD)
<span class="kw">names</span>(CRU_GSOD) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"STNID"</span>, CRU_stack_names)</code></pre></div>
</div>
</div>
<div id="data-reference-and-abstract" class="section level1">
<h1 class="hasAnchor">
<a href="#data-reference-and-abstract" class="anchor"></a>Data reference and abstract</h1>
<blockquote>
<p>Mark New (1,*), David Lister (2), Mike Hulme (3), Ian Makin (4) A high-resolution data set of surface climate over global land areas Climate Research, 2000, Vol 21, pg 1-25 (1) School of Geography and the Environment, University of Oxford, Mansfield Road, Oxford OX1 3TB, United Kingdom (2) Climatic Research Unit, and (3) Tyndall Centre for Climate Change Research, both at School of Environmental Sciences, University of East Anglia, Norwich NR4 7TJ, United Kingdom (4) International Water Management Institute, PO Box 2“07”5, Colombo, Sri Lanka</p>
</blockquote>
<blockquote>
<p><strong>ABSTRACT:</strong> We describe the construction of a 10-minute latitude/longitude data set of mean monthly surface climate over global land areas, excluding Antarctica. The climatology includes 8 climate elements - precipitation, wet-day frequency, temperature, diurnal temperature range, relative humidity,sunshine duration, ground frost frequency and windspeed - and was interpolated from a data set of station means for the period centred on 1961 to 1990. Precipitation was first defined in terms of the parameters of the Gamma distribution, enabling the calculation of monthly precipitation at any given return period. The data are compared to an earlier data set at 0.5 degrees latitude/longitude resolution and show added value over most regions. The data will have many applications in applied climatology, biogeochemical modelling, hydrology and agricultural meteorology and are available through the School of Geography Oxford (<a href="http://www.geog.ox.ac.uk" class="uri">http://www.geog.ox.ac.uk</a>), the International Water Management Institute “World Water and Climate Atlas” (<a href="http://www.iwmi.org" class="uri">http://www.iwmi.org</a>) and the Climatic Research Unit (<a href="http://www.cru.uea.ac.uk" class="uri">http://www.cru.uea.ac.uk</a>).</p>
</blockquote>
<div id="r-system-information" class="section level2">
<h2 class="hasAnchor">
<a href="#r-system-information" class="anchor"></a>R System Information</h2>
<pre><code>## R version 3.4.0 (2017-04-21)
## Platform: x86_64-apple-darwin16.5.0 (64-bit)
## Running under: macOS Sierra 10.12.5
## 
## Matrix products: default
## BLAS/LAPACK: /usr/local/Cellar/openblas/0.2.19_1/lib/libopenblasp-r0.2.19.dylib
## 
## locale:
## [1] en_AU.UTF-8/en_AU.UTF-8/en_AU.UTF-8/C/en_AU.UTF-8/en_AU.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] GSODR_1.0.2-9      getCRUCLdata_0.1.6
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.11       compiler_3.4.0     RColorBrewer_1.1-2
##  [4] plyr_1.8.4         tools_3.4.0        extrafont_0.17    
##  [7] digest_0.6.12      lattice_0.20-35    lubridate_1.6.0   
## [10] evaluate_0.10      tibble_1.3.3       gtable_0.2.0      
## [13] rlang_0.1.1.9000   curl_2.6           rgdal_1.2-7       
## [16] yaml_2.1.14        Rttf2pt1_1.3.4     raster_2.5-8      
## [19] stringr_1.2.0      dplyr_0.7.0        knitr_1.16        
## [22] hms_0.3            rappdirs_0.3.1     maps_3.2.0        
## [25] rprojroot_1.2      grid_3.4.0         ggalt_0.4.0       
## [28] data.table_1.10.4  glue_1.0.0         R6_2.2.1          
## [31] rmarkdown_1.5      sp_1.2-4           readr_1.1.1       
## [34] purrr_0.2.2.2      ggplot2_2.2.1      tidyr_0.6.3       
## [37] extrafontdb_1.0    magrittr_1.5       backports_1.1.0   
## [40] scales_0.4.1       htmltools_0.3.6    MASS_7.3-47       
## [43] proj4_1.0-8        assertthat_0.2.0   colorspace_1.3-2  
## [46] KernSmooth_2.23-15 ash_1.0-15         stringi_1.1.5     
## [49] lazyeval_0.2.0     munsell_0.4.3</code></pre>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li>
<a href="#download-extract-and-merge-cru-data-with-provided-gsod-climate-data">Download, extract and merge CRU data with provided GSOD climate data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#setup-the-r-session">Setup the R session</a></li>
      <li><a href="#extract-data-for-station-locations">Extract data for station locations</a></li>
      </ul>
</li>
      <li>
<a href="#data-reference-and-abstract">Data reference and abstract</a><ul class="nav nav-pills nav-stacked">
<li><a href="#r-system-information">R System Information</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Adam Sparks.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
